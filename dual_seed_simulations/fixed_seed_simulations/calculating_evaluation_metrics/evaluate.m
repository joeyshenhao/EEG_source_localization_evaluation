tic;
clear;
files=dir([pwd,'/','SNR*.mat']);
for ii=1:length(files)
    load(files(ii).name);
    load(['f',files(ii).name(1:end-4),'f.mat']);
%% Distribution Discrepancy (DD) between original and estimated source energy distribution
    cdfabs(ii,:) = [abs(cdfa(X_est_fulldugh)-cdfa(X_simu)),...
        abs(cdfa(X_est_bstmn)-cdfa(X_simu)),...
        abs(cdfa(X_est_eloreta)-cdfa(X_simu)),...
        abs(cdfa(X_est_thindugh)-cdfa(X_simu)),...
        abs(cdfa(X_est_mackay)-cdfa(X_simu))];

%% RMSE
    rmse(ii,:) = [RMSE(X_est_fulldugh,X_simu),...
        RMSE(X_est_bstmn,X_simu),...
        RMSE(X_est_eloreta,X_simu),...
        RMSE(X_est_thindugh,X_simu),...
        RMSE(X_est_mackay,X_simu)];
%% MSE
    mse(ii,:) = [MSE(X_est_fulldugh,X_simu),...
        MSE(X_est_bstmn,X_simu),...
        MSE(X_est_eloreta,X_simu),...
        MSE(X_est_thindugh,X_simu),...
        MSE(X_est_mackay,X_simu)];
%% LE (unit: mm)
    le_20hz(ii,:) = [LE(X_filtered_est_fulldugh(:,:,1),indx(1)),...
        LE(X_filtered_est_bstmn(:,:,1),indx(1)),...
        LE(X_filtered_est_eloreta(:,:,1),indx(1)),...
        LE(X_filtered_est_thindugh(:,:,1),indx(1)),...
        LE(X_filtered_est_mackay(:,:,1),indx(1))];

    le_45hz(ii,:) = [LE(X_filtered_est_fulldugh(:,:,2),indx(2)),...
        LE(X_filtered_est_bstmn(:,:,2),indx(2)),...
        LE(X_filtered_est_eloreta(:,:,2),indx(2)),...
        LE(X_filtered_est_thindugh(:,:,2),indx(2)),...
        LE(X_filtered_est_mackay(:,:,2),indx(2))];

%% SD (unit: mm), source-seed distance<"r" as original Active Zone.
% "r"= 3mm = lambda*1;
    sd1_20hz(ii,:) = [SD(X_filtered_est_fulldugh(:,:,1),indx(1),lambda,1),...
        SD(X_filtered_est_bstmn(:,:,1),indx(1),lambda,1),...
        SD(X_filtered_est_eloreta(:,:,1),indx(1),lambda,1),...
        SD(X_filtered_est_thindugh(:,:,1),indx(1),lambda,1),...
        SD(X_filtered_est_mackay(:,:,1),indx(1),lambda,1)];

    sd1_45hz(ii,:) = [SD(X_filtered_est_fulldugh(:,:,2),indx(2),lambda,1),...
        SD(X_filtered_est_bstmn(:,:,2),indx(2),lambda,1),...
        SD(X_filtered_est_eloreta(:,:,2),indx(2),lambda,1),...
        SD(X_filtered_est_thindugh(:,:,2),indx(2),lambda,1),...
        SD(X_filtered_est_mackay(:,:,2),indx(2),lambda,1)];
% "r"= 6mm = lambda*2;   
    sd2_20hz(ii,:) = [SD(X_filtered_est_fulldugh(:,:,1),indx(1),lambda,2),...
        SD(X_filtered_est_bstmn(:,:,1),indx(1),lambda,2),...
        SD(X_filtered_est_eloreta(:,:,1),indx(1),lambda,2),...
        SD(X_filtered_est_thindugh(:,:,1),indx(1),lambda,2),...
        SD(X_filtered_est_mackay(:,:,1),indx(1),lambda,2)];

    sd2_45hz(ii,:) = [SD(X_filtered_est_fulldugh(:,:,2),indx(2),lambda,2),...
        SD(X_filtered_est_bstmn(:,:,2),indx(2),lambda,2),...
        SD(X_filtered_est_eloreta(:,:,2),indx(2),lambda,2),...
        SD(X_filtered_est_thindugh(:,:,2),indx(2),lambda,2),...
        SD(X_filtered_est_mackay(:,:,2),indx(2),lambda,2)];  
  
%% SD (unit: mm),  sources where energy>c percent of global maxima as original Active Zone.
% percentage = 1/e;
    sd_37_20hz(ii,:) = [SD_percent(X_simu,X_filtered_est_fulldugh(:,:,1),20,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_bstmn(:,:,1),20,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_eloreta(:,:,1),20,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,1),20,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,1),20,1/exp(1))];

    sd_37_45hz(ii,:) = [SD_percent(X_simu,X_filtered_est_fulldugh(:,:,2),45,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_bstmn(:,:,2),45,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_eloreta(:,:,2),45,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,2),45,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,2),45,1/exp(1))];
% percentage = 0.9;
    sd_90_20hz(ii,:) = [SD_percent(X_simu,X_filtered_est_fulldugh(:,:,1),20,0.9),...
        SD_percent(X_simu,X_filtered_est_bstmn(:,:,1),20,0.9),...
        SD_percent(X_simu,X_filtered_est_eloreta(:,:,1),20,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,1),20,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,1),20,0.9)];

    sd_90_45hz(ii,:) = [SD_percent(X_simu,X_filtered_est_fulldugh(:,:,2),45,0.9),...
        SD_percent(X_simu,X_filtered_est_bstmn(:,:,2),45,0.9),...
        SD_percent(X_simu,X_filtered_est_eloreta(:,:,2),45,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,2),45,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,2),45,0.9)]; 

% percentage = 0.95;
    sd_95_20hz(ii,:) = [SD_percent(X_simu,X_filtered_est_fulldugh(:,:,1),20,0.95),...
        SD_percent(X_simu,X_filtered_est_bstmn(:,:,1),20,0.95),...
        SD_percent(X_simu,X_filtered_est_eloreta(:,:,1),20,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,1),20,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,1),20,0.95)];

    sd_95_45hz(ii,:) = [SD_percent(X_simu,X_filtered_est_fulldugh(:,:,2),45,0.95),...
        SD_percent(X_simu,X_filtered_est_bstmn(:,:,2),45,0.95),...
        SD_percent(X_simu,X_filtered_est_eloreta(:,:,2),45,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,2),45,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,2),45,0.95)]; 
end
  save(['SNR_Results_new.mat'],'mse',"rmse","le_45hz","le_20hz","cdfabs",...
      "sd2_20hz","sd2_45hz","sd_37_20hz","sd_37_45hz","sd_90_20hz","sd_90_45hz",...
      "sd_95_20hz","sd_95_45hz","sd1_20hz","sd1_45hz");
toc;