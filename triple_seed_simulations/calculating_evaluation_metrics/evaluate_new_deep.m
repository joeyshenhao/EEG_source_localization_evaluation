tic;
clear;
files=dir([pwd,'/','SNR*Deep.mat']);

for ii=1:length(files)
    load(files(ii).name);
    load(['f',files(ii).name(1:end-4),'_f.mat']);
%% Distribution Discrepancy (DD) between original and estimated source energy distribution
    cdfabs(ii,:) = [abs(cdfa(X_est_eloreta)-cdfa(X_simu)),...
        abs(cdfa(X_est_thindugh)-cdfa(X_simu)),...
        abs(cdfa(X_est_mackay)-cdfa(X_simu))];

%% RMSE
    rmse(ii,:) = [RMSE(X_est_eloreta,X_simu),...
        RMSE(X_est_thindugh,X_simu),...
        RMSE(X_est_mackay,X_simu)];
%% MSE
    mse(ii,:) = [MSE(X_est_eloreta,X_simu),...
        MSE(X_est_thindugh,X_simu),...
        MSE(X_est_mackay,X_simu)];
%% LE (unit: mm)
% seed_freq_list = [0.2 0.7 3 5 11 17 43 67];
% 0.2Hz seed
if length(find(seed_freq==0.2))==1
    if seed_freq(1,1)==0.2
        le_0_2hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,1),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,1),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,1),seed_indx(1))];
    else
        le_0_2hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,1),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,1),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,1),seed_indx(2))];
    end
else
    if seed_freq(1,1)==0.2
        le_0_2hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,1),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,1),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,1),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,1),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,1),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,1),seed_indx(3)))];
    else
        le_0_2hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,1),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,1),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,1),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,1),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,1),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,1),seed_indx(3)))];
    end      
end
% 0.7Hz seed
if length(find(seed_freq==0.7))==1
    if seed_freq(1,1)==0.2
        le_0_7hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,2),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,2),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,2),seed_indx(1))];
    else
        le_0_7hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,2),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,2),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,2),seed_indx(2))];
    end
else
    if seed_freq(1,1)==0.2
        le_0_7hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,2),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,2),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,2),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,2),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,2),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,2),seed_indx(3)))];
    else
        le_0_7hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,2),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,2),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,2),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,2),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,2),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,2),seed_indx(3)))];
    end      
end
% 3Hz seed
if length(find(seed_freq==3))==1
    if seed_freq(1,1)==0.2
        le_3hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,3),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,3),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,3),seed_indx(1))];
    else
        le_3hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,3),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,3),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,3),seed_indx(2))];
    end
else
    if seed_freq(1,1)==0.2
        le_3hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,3),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,3),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,3),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,3),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,3),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,3),seed_indx(3)))];
    else
        le_3hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,3),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,3),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,3),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,3),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,3),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,3),seed_indx(3)))];
    end      
end
% 5Hz seed
if length(find(seed_freq==5))==1
    if seed_freq(1,1)==0.2
        le_5hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,4),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,4),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,4),seed_indx(1))];
    else
        le_5hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,4),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,4),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,4),seed_indx(2))];
    end
else
    if seed_freq(1,1)==0.2
        le_5hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,4),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,4),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,4),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,4),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,4),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,4),seed_indx(3)))];
    else
        le_5hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,4),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,4),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,4),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,4),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,4),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,4),seed_indx(3)))];
    end      
end
% 11Hz seed
if length(find(seed_freq==11))==1
    if seed_freq(1,1)==11
        le_11hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,5),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,5),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,5),seed_indx(1))];
    else
        le_11hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,5),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,5),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,5),seed_indx(2))];
    end
else
    if seed_freq(1,1)==11
        le_11hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,5),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,5),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,5),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,5),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,5),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,5),seed_indx(3)))];
    else
        le_11hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,5),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,5),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,5),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,5),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,5),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,5),seed_indx(3)))];
    end      
end
% 17Hz seed
if length(find(seed_freq==17))==1
    if seed_freq(1,1)==11
        le_17hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,6),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,6),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,6),seed_indx(1))];
    else
        le_17hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,6),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,6),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,6),seed_indx(2))];
    end
else
    if seed_freq(1,1)==11
        le_17hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,6),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,6),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,6),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,6),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,6),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,6),seed_indx(3)))];
    else
        le_17hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,6),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,6),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,6),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,6),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,6),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,6),seed_indx(3)))];
    end      
end
% 43Hz seed
if length(find(seed_freq==43))==1
    if seed_freq(1,1)==11
        le_43hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,7),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,7),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,7),seed_indx(1))];
    else
        le_43hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,7),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,7),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,7),seed_indx(2))];
    end
else
    if seed_freq(1,1)==11
        le_43hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,7),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,7),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,7),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,7),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,7),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,7),seed_indx(3)))];
    else
        le_43hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,7),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,7),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,7),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,7),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,7),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,7),seed_indx(3)))];
    end      
end
% 67Hz seed
if length(find(seed_freq==67))==1
    if seed_freq(1,1)==11
        le_67hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,8),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,8),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,8),seed_indx(1))];
    else
        le_67hz(ii,:) = [LE(X_filtered_est_eloreta(:,:,8),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,8),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,8),seed_indx(2))];
    end
else
    if seed_freq(1,1)==11
        le_67hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,8),seed_indx(1)),...
            LE(X_filtered_est_eloreta(:,:,8),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,8),seed_indx(1)),...
            LE(X_filtered_est_mackay(:,:,8),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,8),seed_indx(1)),...
            LE(X_filtered_est_thindugh(:,:,8),seed_indx(3)))];
    else
        le_67hz(ii,:) = [min(LE(X_filtered_est_eloreta(:,:,8),seed_indx(2)),...
            LE(X_filtered_est_eloreta(:,:,8),seed_indx(3))),...
            min(LE(X_filtered_est_mackay(:,:,8),seed_indx(2)),...
            LE(X_filtered_est_mackay(:,:,8),seed_indx(3))),...
            min(LE(X_filtered_est_thindugh(:,:,8),seed_indx(2)),...
            LE(X_filtered_est_thindugh(:,:,8),seed_indx(3)))];
    end      
end
%% SD (unit: mm),  sources where energy>c percent of global maxima as original Active Zone.
% percentage = 1/e;
% seed_freq_list = [0.2 0.7 3 5 11 17 43 67];
    sd_37_0_2hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,1),0.2,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,1),0.2,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,1),0.2,1/exp(1))];
    sd_37_0_7hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,2),0.7,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,2),0.7,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,2),0.7,1/exp(1))];
    sd_37_3hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,3),3,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,3),3,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,3),3,1/exp(1))];
    sd_37_5hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,4),5,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,4),5,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,4),5,1/exp(1))];
    sd_37_11hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,5),11,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,5),11,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,5),11,1/exp(1))];
    sd_37_17hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,6),17,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,6),17,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,6),17,1/exp(1))];
    sd_37_43hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,7),43,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,7),43,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,7),43,1/exp(1))];
    sd_37_67hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,8),67,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,8),67,1/exp(1)),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,8),67,1/exp(1))];
% percentage = 0.9;
    sd_90_0_2hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,1),0.2,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,1),0.2,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,1),0.2,0.9)];
    sd_90_0_7hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,2),0.7,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,2),0.7,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,2),0.7,0.9)];
    sd_90_3hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,3),3,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,3),3,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,3),3,0.9)];
    sd_90_5hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,4),5,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,4),5,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,4),5,0.9)];
    sd_90_11hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,5),11,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,5),11,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,5),11,0.9)];
    sd_90_17hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,6),17,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,6),17,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,6),17,0.9)];
    sd_90_43hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,7),43,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,7),43,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,7),43,0.9)];
    sd_90_67hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,8),67,0.9),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,8),67,0.9),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,8),67,0.9)];
% percentage = 0.95;
    sd_95_0_2hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,1),0.2,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,1),0.2,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,1),0.2,0.95)];
    sd_95_0_7hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,2),0.7,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,2),0.7,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,2),0.7,0.95)];
    sd_95_3hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,3),3,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,3),3,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,3),3,0.95)];
    sd_95_5hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,4),5,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,4),5,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,4),5,0.95)];
    sd_95_11hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,5),11,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,5),11,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,5),11,0.95)];
    sd_95_17hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,6),17,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,6),17,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,6),17,0.95)];
    sd_95_43hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,7),43,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,7),43,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,7),43,0.95)];
    sd_95_67hz(ii,:) = [SD_percent(X_simu,X_filtered_est_eloreta(:,:,8),67,0.95),...
        SD_percent(X_simu,X_filtered_est_thindugh(:,:,8),67,0.95),...
        SD_percent(X_simu,X_filtered_est_mackay(:,:,8),67,0.95)];
end
  save(['SNR_Results_Deep.mat'],'mse',"rmse","cdfabs",'le_67hz','le_43hz',...
      "le_17hz",'le_11hz',"le_5hz","le_3hz","le_0_7hz","le_0_2hz",...
      "sd_95_67hz","sd_95_43hz","sd_95_17hz","sd_95_11hz","sd_95_5hz",...
      "sd_95_3hz","sd_95_0_7hz","sd_95_0_2hz",...
      "sd_90_67hz","sd_90_43hz","sd_90_17hz","sd_90_11hz","sd_90_5hz",...
      "sd_90_3hz","sd_90_0_7hz","sd_90_0_2hz",...
      "sd_37_67hz","sd_37_43hz","sd_37_17hz","sd_37_11hz","sd_37_5hz",...
      "sd_37_3hz","sd_37_0_7hz","sd_37_0_2hz");
% clearvars -except TCE SNR_est relative_est_source_maxamp
toc;